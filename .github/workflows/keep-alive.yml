name: Keep Streamlit App Alive

on:
  schedule:
    # 3æ™‚é–“ã”ã¨ã«å®Ÿè¡Œï¼ˆUTCæ™‚é–“ã§æŒ‡å®šï¼‰
    # ä¾‹: 0æ™‚ã€3æ™‚ã€6æ™‚ã€9æ™‚ã€12æ™‚ã€15æ™‚ã€18æ™‚ã€21æ™‚ï¼ˆUTCï¼‰
    - cron: '0 */3 * * *'
  
  # æ‰‹å‹•å®Ÿè¡Œã‚’å¯èƒ½ã«ã™ã‚‹
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Streamlit App
      run: |
        echo "ğŸ”„ Pinging Streamlit app to keep it alive..."
        echo "Current time: $(date)"
        
        # ã‚¢ãƒ—ãƒªã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¯è¿½å¾“ã—ãªã„ï¼‰
        response=$(curl -s -o /dev/null -w "%{http_code}" https://ichijo-3dmaker.streamlit.app/ --max-time 30)
        
        # 2xxã¾ãŸã¯3xxã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æˆåŠŸã¨ã¿ãªã™ï¼ˆStreamlitã¯303ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¿”ã™ï¼‰
        if [ $response -ge 200 ] && [ $response -lt 400 ]; then
          echo "âœ… Successfully pinged app (HTTP $response)"
        else
          echo "âš ï¸ Received HTTP code: $response"
          exit 1
        fi
        
        echo "Completed at $(date)"
